<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hệ thống cấp tài khoản của Công Coka</title>
<style>
    /* Thêm CSS tùy chỉnh */
body {
font-family: Arial, sans-serif;
background: #f4f4f4;
@@ -150,7 +151,7 @@
if (navigator.clipboard) {
navigator.clipboard.writeText(value).then(() => {
showMessage("Đã copy tài khoản: " + value);
          markAccountAsUsed(currentAccountId);  // Đánh dấu tài khoản đã sử dụng
          moveToUsed(currentAccountId);  // Chuyển tài khoản đã copy sang mục đã sử dụng
}).catch((err) => {
alert("Lỗi khi sao chép: " + err);
});
@@ -177,128 +178,126 @@
document.body.removeChild(textArea);
}

    // Đánh dấu tài khoản đã sử dụng
    function markAccountAsUsed(accountId) {
      if (accountId) {
        db.ref(`accounts/${accountId}`).once('value').then(snapshot => {
          const accountData = snapshot.val();
          if (accountData) {
            // Đánh dấu tài khoản đã sử dụng
            db.ref(`used_accounts/${accountId}`).set(accountData).then(() => {
              // Xóa tài khoản khỏi mục chưa sử dụng sau khi đã sao chép
              db.ref(`accounts/${accountId}`).remove().then(() => {
                refreshAccount();
                refreshUsedAccount();
              });
    // Move account to used after being copied
    function moveToUsed(accountId) {
      db.ref(`accounts/${accountId}`).once('value').then(snapshot => {
        const accountData = snapshot.val();
        if (accountData) {
          // Move account to used
          db.ref(`used_accounts/${accountId}`).set(accountData).then(() => {
            // Once successfully moved, remove it from the available accounts
            db.ref(`accounts/${accountId}`).remove().then(() => {
              refreshAccount();  // Refresh both accounts sections
              refreshUsedAccount();
});
          }
        }).catch(error => {
          console.error("Lỗi khi di chuyển tài khoản:", error);
        });
      }
          });
        }
      }).catch(error => {
        console.error("Lỗi khi di chuyển tài khoản:", error);
      });
}

function showMessage(message) {
messageEl.innerText = message;
messageEl.className = 'message';
document.body.appendChild(messageEl);
setTimeout(() => {
messageEl.style.display = "none";
}, 2000);
}

function refreshAccount() {
db.ref("accounts").once("value").then(snapshot => {
const data = snapshot.val();
const entries = Object.entries(data || {}).filter(([key, acc]) => acc && !acc.used && !acc.fixed);
totalCountEl.innerText = `Tổng số tài khoản chưa sử dụng: ${entries.length}`;

if (entries.length === 0) {
content.innerHTML = "<p>Hết tài khoản để cấp!</p>";
return;
}

const [id, acc] = entries[Math.floor(Math.random() * entries.length)];
currentAccountId = id;
localStorage.setItem("savedAccountId", id);
renderAccount(acc);
}).catch(error => {
console.error("Lỗi khi lấy dữ liệu tài khoản:", error);
});
}

function refreshUsedAccount() {
db.ref('used_accounts').once('value').then(snapshot => {
const data = snapshot.val();
const usedAccounts = Object.entries(data || {});
usedCountEl.innerText = `Tổng số tài khoản đã sử dụng: ${usedAccounts.length}`;
displayUsedAccounts(usedAccounts);
}).catch((error) => {
console.error("Lỗi khi lấy tài khoản đã sử dụng:", error);
});
}

function displayUsedAccounts(accounts) {
usedContent.innerHTML = accounts.map(([key, account]) => `
       <div class='label'>Tên đăng nhập:</div>
       <div class='value'><span id='usedUser'>${account.username}</span><button onclick="copyUsedAccount('usedUser', '${key}')">Copy</button></div>
       <div class='label'>Mật khẩu:</div>
       <div class='value'><span id='usedPass'>${account.password}</span><button onclick="copyUsedAccount('usedPass', '${key}')">Copy</button></div>
     `).join('');
}

function copyUsedAccount(id, key) {
const value = document.getElementById(id).innerText;
if (navigator.clipboard) {
navigator.clipboard.writeText(value).then(() => {
alert("Đã copy tài khoản đã sử dụng: " + value);
db.ref(`used_accounts/${key}`).remove();  // Xóa tài khoản sau khi copy
}).catch((err) => {
alert("Lỗi khi sao chép: " + err);
});
}
}

function deleteCurrentAccount() {
if (currentAccountId) {
const confirmDelete = confirm("Bạn có chắc chắn muốn xóa tài khoản này không?");
if (!confirmDelete) return;

db.ref(`accounts/${currentAccountId}`).remove().then(() => {
localStorage.removeItem('savedAccountId');
alert("🗑 Tài khoản đã được xóa!");
refreshAccount();
}).catch((error) => {
console.error("Lỗi khi xóa tài khoản:", error);
});
}
}

function renderAccount(acc) {
const html = `
       <div class='label'>Tên đăng nhập:</div>
       <div class='value'><span id='user'>${acc.username}</span><button onclick="copyText('user')">Copy</button></div>
       <div class='label'>Mật khẩu:</div>
       <div class='value'><span id='pass'>${acc.password}</span><button onclick="copyText('pass')">Copy</button></div>
       <div class='label'>Email:</div>
       <div class='value'><span id='mail'>${acc.email}</span><button onclick="copyText('mail')">Copy</button></div>
       <div class='label'>Mật khẩu Email:</div>
       <div class='value'><span id='passmail'>${acc.passmail}</span><button onclick="copyText('passmail')">Copy</button></div>
     `;
content.innerHTML = html;
}

window.onload = function() {
refreshAccount();
refreshUsedAccount();
}

function showTab(tabName) {
document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
document.getElementById(tabName).classList.add('active');
document.querySelector(`button[onclick="showTab('${tabName}')"]`).classList.add('active');
}
</script>
</body>
</html>
