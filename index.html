<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Há»‡ thá»‘ng cáº¥p tÃ i khoáº£n cá»§a CÃ´ng Coka</title>
<style>
    /* ThÃªm CSS tÃ¹y chá»‰nh */
body {
font-family: Arial, sans-serif;
background: #f4f4f4;
@@ -150,7 +151,7 @@
if (navigator.clipboard) {
navigator.clipboard.writeText(value).then(() => {
showMessage("ÄÃ£ copy tÃ i khoáº£n: " + value);
          markAccountAsUsed(currentAccountId);  // ÄÃ¡nh dáº¥u tÃ i khoáº£n Ä‘Ã£ sá»­ dá»¥ng
          moveToUsed(currentAccountId);  // Chuyá»ƒn tÃ i khoáº£n Ä‘Ã£ copy sang má»¥c Ä‘Ã£ sá»­ dá»¥ng
}).catch((err) => {
alert("Lá»—i khi sao chÃ©p: " + err);
});
@@ -177,128 +178,126 @@
document.body.removeChild(textArea);
}

    // ÄÃ¡nh dáº¥u tÃ i khoáº£n Ä‘Ã£ sá»­ dá»¥ng
    function markAccountAsUsed(accountId) {
      if (accountId) {
        db.ref(`accounts/${accountId}`).once('value').then(snapshot => {
          const accountData = snapshot.val();
          if (accountData) {
            // ÄÃ¡nh dáº¥u tÃ i khoáº£n Ä‘Ã£ sá»­ dá»¥ng
            db.ref(`used_accounts/${accountId}`).set(accountData).then(() => {
              // XÃ³a tÃ i khoáº£n khá»i má»¥c chÆ°a sá»­ dá»¥ng sau khi Ä‘Ã£ sao chÃ©p
              db.ref(`accounts/${accountId}`).remove().then(() => {
                refreshAccount();
                refreshUsedAccount();
              });
    // Move account to used after being copied
    function moveToUsed(accountId) {
      db.ref(`accounts/${accountId}`).once('value').then(snapshot => {
        const accountData = snapshot.val();
        if (accountData) {
          // Move account to used
          db.ref(`used_accounts/${accountId}`).set(accountData).then(() => {
            // Once successfully moved, remove it from the available accounts
            db.ref(`accounts/${accountId}`).remove().then(() => {
              refreshAccount();  // Refresh both accounts sections
              refreshUsedAccount();
});
          }
        }).catch(error => {
          console.error("Lá»—i khi di chuyá»ƒn tÃ i khoáº£n:", error);
        });
      }
          });
        }
      }).catch(error => {
        console.error("Lá»—i khi di chuyá»ƒn tÃ i khoáº£n:", error);
      });
}

function showMessage(message) {
messageEl.innerText = message;
messageEl.className = 'message';
document.body.appendChild(messageEl);
setTimeout(() => {
messageEl.style.display = "none";
}, 2000);
}

function refreshAccount() {
db.ref("accounts").once("value").then(snapshot => {
const data = snapshot.val();
const entries = Object.entries(data || {}).filter(([key, acc]) => acc && !acc.used && !acc.fixed);
totalCountEl.innerText = `Tá»•ng sá»‘ tÃ i khoáº£n chÆ°a sá»­ dá»¥ng: ${entries.length}`;

if (entries.length === 0) {
content.innerHTML = "<p>Háº¿t tÃ i khoáº£n Ä‘á»ƒ cáº¥p!</p>";
return;
}

const [id, acc] = entries[Math.floor(Math.random() * entries.length)];
currentAccountId = id;
localStorage.setItem("savedAccountId", id);
renderAccount(acc);
}).catch(error => {
console.error("Lá»—i khi láº¥y dá»¯ liá»‡u tÃ i khoáº£n:", error);
});
}

function refreshUsedAccount() {
db.ref('used_accounts').once('value').then(snapshot => {
const data = snapshot.val();
const usedAccounts = Object.entries(data || {});
usedCountEl.innerText = `Tá»•ng sá»‘ tÃ i khoáº£n Ä‘Ã£ sá»­ dá»¥ng: ${usedAccounts.length}`;
displayUsedAccounts(usedAccounts);
}).catch((error) => {
console.error("Lá»—i khi láº¥y tÃ i khoáº£n Ä‘Ã£ sá»­ dá»¥ng:", error);
});
}

function displayUsedAccounts(accounts) {
usedContent.innerHTML = accounts.map(([key, account]) => `
       <div class='label'>TÃªn Ä‘Äƒng nháº­p:</div>
       <div class='value'><span id='usedUser'>${account.username}</span><button onclick="copyUsedAccount('usedUser', '${key}')">Copy</button></div>
       <div class='label'>Máº­t kháº©u:</div>
       <div class='value'><span id='usedPass'>${account.password}</span><button onclick="copyUsedAccount('usedPass', '${key}')">Copy</button></div>
     `).join('');
}

function copyUsedAccount(id, key) {
const value = document.getElementById(id).innerText;
if (navigator.clipboard) {
navigator.clipboard.writeText(value).then(() => {
alert("ÄÃ£ copy tÃ i khoáº£n Ä‘Ã£ sá»­ dá»¥ng: " + value);
db.ref(`used_accounts/${key}`).remove();  // XÃ³a tÃ i khoáº£n sau khi copy
}).catch((err) => {
alert("Lá»—i khi sao chÃ©p: " + err);
});
}
}

function deleteCurrentAccount() {
if (currentAccountId) {
const confirmDelete = confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a tÃ i khoáº£n nÃ y khÃ´ng?");
if (!confirmDelete) return;

db.ref(`accounts/${currentAccountId}`).remove().then(() => {
localStorage.removeItem('savedAccountId');
alert("ðŸ—‘ TÃ i khoáº£n Ä‘Ã£ Ä‘Æ°á»£c xÃ³a!");
refreshAccount();
}).catch((error) => {
console.error("Lá»—i khi xÃ³a tÃ i khoáº£n:", error);
});
}
}

function renderAccount(acc) {
const html = `
       <div class='label'>TÃªn Ä‘Äƒng nháº­p:</div>
       <div class='value'><span id='user'>${acc.username}</span><button onclick="copyText('user')">Copy</button></div>
       <div class='label'>Máº­t kháº©u:</div>
       <div class='value'><span id='pass'>${acc.password}</span><button onclick="copyText('pass')">Copy</button></div>
       <div class='label'>Email:</div>
       <div class='value'><span id='mail'>${acc.email}</span><button onclick="copyText('mail')">Copy</button></div>
       <div class='label'>Máº­t kháº©u Email:</div>
       <div class='value'><span id='passmail'>${acc.passmail}</span><button onclick="copyText('passmail')">Copy</button></div>
     `;
content.innerHTML = html;
}

window.onload = function() {
refreshAccount();
refreshUsedAccount();
}

function showTab(tabName) {
document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
document.getElementById(tabName).classList.add('active');
document.querySelector(`button[onclick="showTab('${tabName}')"]`).classList.add('active');
}
</script>
</body>
</html>
